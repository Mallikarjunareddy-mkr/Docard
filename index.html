<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mobile File Manager</title>
<style>
* { box-sizing: border-box; }
body { margin:0; font-family: Arial; background:#f5f5f5; }
header { background:#333; color:white; padding:1rem; text-align:center; }
button { padding:8px 12px; margin:3px; cursor:pointer; border:none; border-radius:5px; }
.container { padding:10px; }
#homePage, #fileManager, #cloudManager { display:none; }
#homePage { display:flex; flex-direction:column; align-items:center; justify-content:center; height:80vh; }
.optionButton { width:80%; margin:10px 0; font-size:1.2rem; background:#007bff; color:white; }
#sidebar { width:100%; display:flex; overflow-x:auto; margin-bottom:10px; }
#sidebar button { flex:0 0 auto; margin-right:5px; }
#fileView { display:flex; flex-wrap:wrap; gap:10px; }
.fileItem { flex:1 1 45%; border:1px solid #ccc; border-radius:8px; padding:10px; display:flex; flex-direction:column; align-items:center; text-align:center; min-width:120px; background:#fff; }
.fileItem span.icon { font-size:2rem; }
.breadcrumb { margin-bottom:10px; font-size:0.9rem; color:#555; }
.dark-mode { background:#222; color:#eee; }
.dark-mode #fileView .fileItem { background:#333; border-color:#555; }
#fileInput { display:none; }
</style>
</head>
<body>

<header>
<h1>Mobile File Manager</h1>
</header>

<!-- Home Page -->
<div class="container" id="homePage">
  <button class="optionButton" onclick="openLocal()">Local Storage</button>
  <button class="optionButton" onclick="openCloud()">Cloud Storage</button>
</div>

<!-- Local Storage Manager -->
<div class="container" id="fileManager">
  <div id="sidebar">
    <button onclick="goHome()">Back</button>
    <button onclick="createFolder()">New Folder</button>
    <button onclick="createFile()">New File</button>
    <button onclick="uploadFiles()">Upload</button>
    <button onclick="toggleDarkMode()">Dark Mode</button>
    <input type="text" id="searchBox" placeholder="Search..." oninput="searchFiles()">
    <input type="file" id="fileInput" multiple onchange="handleFileUpload(event)">
  </div>
  <div class="breadcrumb" id="breadcrumb"></div>
  <div id="fileView"></div>
</div>

<!-- Cloud Storage Manager -->
<div class="container" id="cloudManager">
  <button onclick="goHome()">Back</button>
  <h2>Cloud Storage (Coming Soon)</h2>
  <p>Cloud integration placeholder. Will support Google Drive, Dropbox, OneDrive.</p>
</div>

<script>
// =================== Navigation ===================
function openLocal(){ document.getElementById('homePage').style.display='none'; document.getElementById('fileManager').style.display='block'; initDB(); }
function openCloud(){ document.getElementById('homePage').style.display='none'; document.getElementById('cloudManager').style.display='block'; }
function goHome(){ document.getElementById('fileManager').style.display='none'; document.getElementById('cloudManager').style.display='none'; document.getElementById('homePage').style.display='flex'; }

// =================== Dark Mode ===================
function toggleDarkMode(){ document.body.classList.toggle('dark-mode'); }

// =================== IndexedDB ===================
let db; let currentParent=null;
function initDB(){
  const request=indexedDB.open("FileManagerDB",1);
  request.onerror=e=>console.error(e);
  request.onsuccess=e=>{ db=e.target.result; loadFiles(); };
  request.onupgradeneeded=e=>{ db=e.target.result; const store=db.createObjectStore("files",{keyPath:"id",autoIncrement:true}); store.createIndex("name","name",{unique:false}); store.createIndex("type","type",{unique:false}); store.createIndex("parent","parent",{unique:false}); };
}

// =================== CRUD ===================
function addFileToDB(file){ const tx=db.transaction("files","readwrite"); tx.objectStore("files").add(file); tx.oncomplete=()=>{ loadFiles(); }; }
function getAllFiles(callback){ const tx=db.transaction("files","readonly"); tx.objectStore("files").getAll().onsuccess=e=>callback(e.target.result); }

// =================== File UI ===================
function loadFiles(filter=''){
  getAllFiles(files=>{
    const view=document.getElementById('fileView'); view.innerHTML='';
    const breadcrumb=document.getElementById('breadcrumb'); breadcrumb.innerHTML='';
    let path=[], ptr=currentParent; while(ptr){ path.unshift(ptr); ptr=ptr.parentRef; }
    breadcrumb.innerHTML=path.map(p=>`<span style="cursor:pointer;color:blue;" onclick="goToFolder(${p.id})">${p.name}</span>`).join(" / ");
    files.forEach(f=>{
      if(f.parent!== (currentParent?currentParent.id:null)) return;
      if(filter && !f.name.toLowerCase().includes(filter.toLowerCase())) return;
      const div=document.createElement('div'); div.className='fileItem';
      let icon='üìÑ'; if(f.type==='folder') icon='üìÅ'; else if(f.name.match(/\.(jpg|jpeg|png|gif)$/i)) icon='üñºÔ∏è'; else if(f.name.match(/\.pdf$/i)) icon='üìï';
      div.innerHTML=`<span class="icon">${icon}</span><strong>${f.name}</strong>
        <div style="margin-top:5px;">
          ${f.type==='folder'?`<button onclick="enterFolder(${f.id})">Open</button>`:''}
          ${f.type==='file'?`<button onclick="previewFile(${f.id})">Preview</button> <button onclick="downloadFile(${f.id})">Download</button>`:''}
          <button onclick="renameFile(${f.id})">Rename</button>
          <button onclick="deleteFile(${f.id})">Delete</button>
        </div>`;
      view.appendChild(div);
    });
  });
}

// =================== File Actions ===================
function createFolder(){ const name=prompt("Folder name:"); if(name) addFileToDB({name,type:'folder',parent:currentParent?currentParent.id:null}); }
function createFile(){ const name=prompt("File name:"); if(name){ const content=prompt("File content:"); addFileToDB({name,type:'file',content,parent:currentParent?currentParent.id:null}); } }
function renameFile(id){ const newName=prompt("New name:"); if(!newName) return; const tx=db.transaction("files","readwrite"); const store=tx.objectStore("files"); store.get(Number(id)).onsuccess=e=>{ const file=e.target.result; file.name=newName; store.put(file); tx.oncomplete=()=>{ loadFiles(); }; }; }
function deleteFile(id){ if(confirm("Delete?")){ const tx=db.transaction("files","readwrite"); tx.objectStore("files").delete(Number(id)); tx.oncomplete=()=>{ loadFiles(); }; } }
function previewFile(id){ const tx=db.transaction("files","readonly"); tx.objectStore("files").get(Number(id)).onsuccess=e=>{ const f=e.target.result; if(f.content instanceof Blob){ const url=URL.createObjectURL(f.content); window.open(url); setTimeout(()=>URL.revokeObjectURL(url),60000); }else alert(f.content); }; }
function downloadFile(id){ const tx=db.transaction("files","readonly"); tx.objectStore("files").get(Number(id)).onsuccess=e=>{ const f=e.target.result; if(f.content instanceof Blob){ const url=URL.createObjectURL(f.content); const a=document.createElement('a'); a.href=url; a.download=f.name; a.click(); URL.revokeObjectURL(url); }else{ const blob=new Blob([f.content],{type:'text/plain'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=f.name; a.click(); URL.revokeObjectURL(url); } }; }
function searchFiles(){ loadFiles(document.getElementById('searchBox').value); }

// =================== Nested Folders ===================
function enterFolder(id){ const tx=db.transaction("files","readonly"); tx.objectStore("files").get(Number(id)).onsuccess=e=>{ currentParent=e.target.result; currentParent.parentRef=null; loadFiles(); }; }
function goToFolder(id){ const tx=db.transaction("files","readonly"); tx.objectStore("files").get(Number(id)).onsuccess=e=>{ currentParent=e.target.result; loadFiles(); }; }

// =================== File Upload ===================
function uploadFiles(){ document.getElementById('fileInput').click(); }
function handleFileUpload(event){ const files=event.target.files; Array.from(files).forEach(file=>{ const reader=new FileReader(); reader.onload=e=>{ const content=new Blob([e.target.result],{type:file.type}); addFileToDB({name:file.name,type:'file',content,parent:currentParent?currentParent.id:null}); }; reader.readAsArrayBuffer(file); }); event.target.value=''; }
</script>
</body>
</html>s[p]){ const div=document.createElement('div'); div.innerHTML=`<h3>${p.toUpperCase()}</h3><p>Files synced locally (offline caching placeholder)</p>`; cloudDiv.appendChild(div); } } if(!Object.values(cloudAccounts).includes(true)) cloudDiv.innerHTML='<p>No cloud accounts connected.</p>'; }
</script>
</body>
</html>
