<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nested Android-Style File Manager with Back Button</title>
<style>
    body { font-family: Arial, sans-serif; margin:0; padding:0; background:#fafafa; }
    header { padding:10px; background:#f0f0f0; font-weight:bold; display:flex; flex-wrap:wrap; align-items:center; font-size:14px; }
    #backBtn { margin-right:10px; cursor:pointer; color:#0d6efd; font-weight:bold; }
    #backBtn.disabled { color:#aaa; cursor:default; }
    header span { margin-right:5px; cursor:pointer; color:#0d6efd; }
    #fileArea { padding:10px; }
    .folder, .file { padding:10px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center; border-radius:5px; margin-bottom:5px; background:#fff; box-shadow:0 1px 2px rgba(0,0,0,0.05); }
    .folder:hover, .file:hover { background:#e8f0fe; }
    .folder span:first-child, .file span:first-child { display:flex; align-items:center; }
    .folder span:first-child::before { content:"üìÅ"; margin-right:8px; }
    .file span:first-child::before { content:"üìÑ"; margin-right:8px; }
    .fab { position:fixed; bottom:30px; right:30px; background:#0d6efd; color:#fff; width:60px; height:60px; border-radius:50%; font-size:36px; display:flex; align-items:center; justify-content:center; cursor:pointer; box-shadow:0 2px 5px rgba(0,0,0,0.3); }
    #fabMenu { position:fixed; bottom:100px; right:30px; background:#fff; border:1px solid #ccc; border-radius:5px; display:none; flex-direction:column; }
    #fabMenu button { padding:10px 20px; border:none; background:none; cursor:pointer; text-align:left; }
    #fileOperations { display:none; position:fixed; bottom:100px; left:50%; transform:translateX(-50%); background:#fff; border:1px solid #ccc; border-radius:5px; padding:5px; display:flex; gap:5px; }
</style>
</head>
<body>

<header>
    <span id="backBtn" class="disabled" onclick="goBack()">‚¨Ö Back</span>
    <span id="breadcrumb"></span>
</header>

<div id="fileArea"></div>

<!-- Floating + Button -->
<div class="fab" onclick="toggleFab()">+</div>
<div id="fabMenu">
    <button onclick="createFolder()">Create Folder</button>
    <button onclick="uploadFile()">Upload File</button>
</div>

<!-- File Operations Toolbar -->
<div id="fileOperations">
    <button onclick="downloadSelected()">Download</button>
    <button onclick="renameSelected()">Rename</button>
    <button onclick="deleteSelected()">Delete</button>
    <button onclick="cancelSelection()">Cancel</button>
</div>

<input type="file" id="fileInput" style="display:none;" onchange="handleFileUpload(event)">

<script>
// State
let path = ['/']; // Breadcrumb path
let files = JSON.parse(localStorage.getItem('files') || '{"\/":{}}');
let selectedFiles = [];

// Utility to get current folder object using path array
function getCurrentFolder() {
    let folder = files;
    for(let i=1;i<path.length;i++){
        folder = folder[path[i]];
    }
    return folder;
}

// Render breadcrumb
function renderBreadcrumb() {
    const bc = document.getElementById('breadcrumb');
    bc.innerHTML = '';
    path.forEach((p, index) => {
        let span = document.createElement('span');
        span.innerText = p;
        span.onclick = () => navigateTo(index);
        bc.appendChild(span);
        if(index < path.length-1) bc.appendChild(document.createTextNode(' / '));
    });

    // Update back button
    const backBtn = document.getElementById('backBtn');
    if(path.length === 1){
        backBtn.classList.add('disabled');
    } else {
        backBtn.classList.remove('disabled');
    }
}

// Back button functionality
function goBack(){
    if(path.length > 1){
        path.pop();
        renderFiles();
    }
}

// Navigate to a folder in breadcrumb
function navigateTo(index) {
    path = path.slice(0,index+1);
    renderFiles();
}

// Render files and folders
function renderFiles() {
    renderBreadcrumb();
    const fileArea = document.getElementById('fileArea');
    fileArea.innerHTML = '';
    const folderObj = getCurrentFolder();
    selectedFiles = [];
    toggleFileOperations(false);

    for(let name in folderObj){
        if(typeof folderObj[name] === 'object'){ // folder
            const div = document.createElement('div');
            div.className = 'folder';
            div.innerHTML = `<span>${name}</span>`;
            div.onclick = () => { path.push(name); renderFiles(); };
            fileArea.appendChild(div);
        } else { // file
            const div = document.createElement('div');
            div.className = 'file';
            div.innerHTML = `<span>${name}</span><input type="checkbox" onchange="toggleSelect(this,'${name}')">`;
            fileArea.appendChild(div);
        }
    }
}

// Floating button
function toggleFab() {
    const menu = document.getElementById('fabMenu');
    menu.style.display = menu.style.display==='flex'?'none':'flex';
}

// Create folder
function createFolder() {
    const name = prompt('Folder Name:');
    if(!name) return;
    const folderObj = getCurrentFolder();
    if(folderObj[name]){ alert('Folder already exists'); return; }
    folderObj[name] = {};
    localStorage.setItem('files', JSON.stringify(files));
    renderFiles();
    toggleFab();
}

// Upload file
function uploadFile() {
    document.getElementById('fileInput').click();
    toggleFab();
}

// Handle file upload
function handleFileUpload(event){
    const file = event.target.files[0];
    const reader = new FileReader();
    reader.onload = function(){
        const folderObj = getCurrentFolder();
        folderObj[file.name] = reader.result;
        localStorage.setItem('files', JSON.stringify(files));
        renderFiles();
    };
    reader.readAsDataURL(file);
}

// File selection
function toggleSelect(checkbox,name){
    if(checkbox.checked) selectedFiles.push(name);
    else selectedFiles = selectedFiles.filter(n=>n!==name);
    toggleFileOperations(selectedFiles.length>0);
}

// Show/hide file operations
function toggleFileOperations(show){
    document.getElementById('fileOperations').style.display = show?'flex':'none';
}

// File operations
function downloadSelected(){
    const folderObj = getCurrentFolder();
    selectedFiles.forEach(name=>{
        const a = document.createElement('a');
        a.href = folderObj[name];
        a.download = name;
        a.click();
    });
    cancelSelection();
}
function deleteSelected(){
    if(!confirm('Delete selected files?')) return;
    const folderObj = getCurrentFolder();
    selectedFiles.forEach(name=>delete folderObj[name]);
    localStorage.setItem('files', JSON.stringify(files));
    cancelSelection();
    renderFiles();
}
function renameSelected(){
    if(selectedFiles.length!==1){ alert('Select only 1 file to rename'); return; }
    const oldName = selectedFiles[0];
    const newName = prompt('New name:',oldName);
    if(!newName) return;
    const folderObj = getCurrentFolder();
    folderObj[newName] = folderObj[oldName];
    delete folderObj[oldName];
    localStorage.setItem('files', JSON.stringify(files));
    cancelSelection();
    renderFiles();
}
function cancelSelection(){
    selectedFiles=[];
    document.querySelectorAll('#fileArea input[type=checkbox]').forEach(cb=>cb.checked=false);
    toggleFileOperations(false);
}

// Initial render
renderFiles();
</script>

</body>
</html>
