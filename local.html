<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Docard - Local File Manager</title>
<link href="https://fonts.googleapis.com/css?family=Roboto:400,700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@700" rel="stylesheet" />
<style>
:root {
    --primary: #1976d2;
    --accent: #00bcd4;
    --bg-dark: #181f2b;
    --card-dark: #232b3a;
    --glow: 0 0 14px #00bcd4,0 0 2px #1976d2;
    --text-glow: 0 0 5px #fff,0 0 2px #00bcd4;
    --radius:14px;
    --shadow: 0 4px 18px #00bcd4;
}
body {
    min-height: 100vh;
    margin: 0;
    background: var(--bg-dark);
    color: #e3eafc;
    font-family: 'Roboto', Arial, sans-serif;
}
.header {
    width: 100%;
    padding: 20px 0 6px 0;
    text-align: center;
    font-size: 1.5em;
    font-weight: bold;
    letter-spacing: 2px;
    text-shadow: var(--text-glow),0 0 18px #1976d2;
    margin-bottom: 4px;
    animation: thunder 1.1s infinite alternate;
}
@keyframes thunder {
    0% { text-shadow: var(--text-glow),0 0 18px #1976d2; }
    100% { text-shadow: var(--text-glow),0 0 22px #00bcd4; }
}
.back-btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    background: var(--card-dark);
    color: #e3eafc;
    border: none;
    font-size: 1em;
    font-weight: 700;
    border-radius: 10px;
    padding: 7px 14px;
    margin-bottom: 10px;
    margin-left: 7px;
    cursor: pointer;
    box-shadow: 0 1px 8px #00bcd4;
    text-decoration: none;
    transition: background .14s;
}
#searchBar {
width: 30%;
}
.back-btn:hover, .back-btn:focus {
    background: #182231;
    color: #fff;
}
.manager-block {
    background: var(--card-dark);
    border-radius: var(--radius);
    margin: 0 auto;
    padding: 10px 8px 22px 8px;
    max-width: 520px;
    box-shadow: var(--shadow);
}
#breadcrumb {
    display: flex;
    flex-wrap: nowrap;
    align-items: center;
    gap: 3px;
    font-size: 14px;
    color: #e3eafc;
    margin-bottom: 8px;
    overflow-x: auto;
    white-space: nowrap;
}
#breadcrumb span {
    color: var(--accent);
    cursor: pointer;
    text-shadow: 0 0 4px #00bcd4;
    text-decoration: underline;
}
.files-toolbar {
    display: flex;
    gap: 7px;
    align-items: center;
    margin-bottom: 7px;
    flex-wrap: wrap;
}
.files-toolbar input {
    border-radius: 8px;
    border: none;
    padding: 7px 13px;
    font-size: 0.96em;
    color: #1976d2;
    background: #e3eafc;
    margin-right: 8px;
    min-width: 70px;
    box-shadow: 0 0 4px #00bcd4;
}
.files-toolbar button {
    background: var(--card-dark);
    color: #e3eafc;
    border: none;
    border-radius: 9px;
    font-size: 0.96em;
    font-weight: bold;
    padding: 7px 12px;
    cursor: pointer;
    box-shadow: 0 1px 8px #00bcd4;
    margin-right: 4px;
    transition: background .14s, color .14s;
}
.files-toolbar button:hover, .files-toolbar button:focus {
    background: #182231;
    color: #fff;
}
#fileArea {
    display: grid;
    grid-template-columns: repeat(auto-fill,minmax(110px,1fr));
    gap: 9px;
    margin-top: 6px;
}
.file-item {
    background: var(--card-dark);
    color: #e3eafc;
    border-radius: 10px;
    box-shadow: 0 1px 8px #00bcd4;
    padding: 9px 9px 9px 9px;
    display: flex;
    flex-direction: column;
    gap: 3px;
    font-size: 0.94em;
    cursor: pointer;
    position: relative;
    transition: box-shadow 0.16s, background .13s, color .13s;
}
.file-item:hover {
    box-shadow: 0 3px 12px #1976d2;
    background: #182231;
    color: #fff;
}
.file-icon {
    font-size: 1.3em;
    color: var(--accent);
    filter: drop-shadow(0 0 4px #00bcd4);
}
.file-name { font-weight: 600; word-break: break-all; }
.file-meta { font-size: 0.8em; color: #b3e5fc; }
.file-checkbox {
    position:absolute;top:7px;right:7px;transform:scale(1.1);
}
.fab {
    position:fixed;bottom:18px;right:18px;width:40px;height:40px;
    border-radius:50%;background:var(--accent);color:#fff;
    font-size:1.2em;display:flex;align-items:center;justify-content:center;
    box-shadow:0 2px 8px #1976d2;cursor:pointer;z-index:20;
    transition:background .16s;
}
.fab:hover { background: #1976d2; }
#fabMenu, #fileOperations {
    position:fixed; right:18px; bottom:65px; background:var(--card-dark); 
    border-radius:11px; box-shadow:0 1px 8px #00bcd4;
    display:none; flex-direction:column; width:120px; z-index:21;
    color:#e3eafc; animation:fadeIn .23s;
}
#fabMenu button, #fileOperations button {
    padding:10px 13px; text-align:left; border:none; background:none;
    cursor:pointer; font-size:0.96em;
    color: inherit;
    transition: background .11s, color .11s;
}
#fabMenu button:hover, #fileOperations button:hover {background:#182231; color:var(--accent);}
.toast {
    position:fixed;bottom:14px;left:50%;transform:translateX(-50%);
    background:var(--accent);color:#fff;padding:8px 14px;
    border-radius:15px;font-size:0.95em;box-shadow:0 2px 8px #1976d2;
    z-index:100;display:none;
}
@media (max-width: 700px) {
    .header { font-size: 1.07em; padding:12px 0 3px 0;}
    .manager-block { padding:7px 2vw 16px 2vw;max-width:97vw;}
    #fileArea { grid-template-columns: repeat(auto-fill,minmax(80px,1fr)); }
    .fab { width:28px;height:28px;font-size:0.9em;}
    #fabMenu, #fileOperations { width:82px; right:8px; bottom:36px;}
    .files-toolbar input { min-width: 46px; font-size:0.89em;}
    .files-toolbar button { font-size:0.89em; padding:5px 8px;}
}
</style>
</head>
<body>
<div class="header">
    Docard Local File Manager
    <a href="index.html" class="back-btn" title="Back to Home">
        <span class="material-symbols-outlined">arrow_back</span>Home
    </a>
</div>
<div class="manager-block">
    <div id="breadcrumb"></div>
    <div class="files-toolbar">
        <button id="backBtn" onclick="goBackManager()">
            <span class="material-symbols-outlined">arrow_back</span>
        </button>
        <input type="text" id="searchBar" placeholder="Search..." oninput="searchFiles(this.value)">
        <button onclick="sortFiles()">
            <span class="material-symbols-outlined">sort</span>
        </button>
        <button onclick="toggleView()">
            <span class="material-symbols-outlined" id="viewIcon">view_list</span>
        </button>
    </div>
    <div id="fileArea" tabindex="0"></div>
</div>
<div class="fab" id="fabBtn" onclick="fabAction()"><span class="material-symbols-outlined">add</span></div>
<div id="fabMenu">
    <button onclick="createFolder()"><span class="material-symbols-outlined">create_new_folder</span></button>
    <button onclick="uploadFile()"><span class="material-symbols-outlined">upload_file</span></button>
</div>
<div id="fileOperations">
    <button onclick="previewSelected()"><span class="material-symbols-outlined">preview</span></button>
    <button onclick="showDetailsSelected()"><span class="material-symbols-outlined">info</span></button>
    <button onclick="downloadSelected()"><span class="material-symbols-outlined">download</span></button>
    <button onclick="renameSelected()"><span class="material-symbols-outlined">edit</span></button>
    <button onclick="confirmDeleteSelected()"><span class="material-symbols-outlined">delete</span></button>
    <button onclick="cancelSelection()"><span class="material-symbols-outlined">cancel</span></button>
</div>
<input type="file" id="fileInput" style="display:none;" multiple onchange="handleFileUpload(event)">
<div class="toast" id="toast"></div>
<script>
let files=JSON.parse(localStorage.getItem('files')||'{"\/":{}}');
let path=['/'], selectedItems=[], isGrid=false, searchQuery='', sortOrder='name';
function goBackManager(){if(path.length > 1) {path.pop();renderFiles();}}
function getCurrentFolder(){ let f=files; for(let i=1;i<path.length;i++) f=f[path[i]]; return f; }
function renderBreadcrumb(){const bc=document.getElementById('breadcrumb'); bc.innerHTML='';
    path.forEach((p,i)=>{let span=document.createElement('span');span.innerText=(i === 0 ? "Root" : p);
        span.onclick=()=>navigateTo(i); bc.appendChild(span); if(i<path.length-1) bc.appendChild(document.createTextNode(' / '));});}
function navigateTo(i){ path=path.slice(0,i+1); renderFiles(); }
function renderFiles(){
    renderBreadcrumb();const fileArea=document.getElementById('fileArea'); fileArea.innerHTML='';
    selectedItems=[]; updateFabIcon(); toggleFileOperations(false);let folderObj=getCurrentFolder();
    let items=Object.keys(folderObj).map(name=>{let isFolder=typeof folderObj[name]==='object' && !folderObj[name].content;
        return {name,isFolder,obj:folderObj[name]};});
    items=items.filter(item=>{if(searchQuery && !item.name.toLowerCase().includes(searchQuery.toLowerCase())) return false;return true;});
    if(sortOrder==='name') items.sort((a,b)=>a.name.localeCompare(b.name));
    else if(sortOrder==='size') items.sort((a,b)=>(b.obj.size||0)-(a.obj.size||0));
    items.forEach(item=>{
        const div=document.createElement('div'); div.className='file-item'; div.tabIndex=0;
        div.innerHTML = `<span class="file-checkbox"><input type="checkbox" onchange="toggleSelect(this,'${item.name}',${item.isFolder})"></span>
            <span class="file-icon">${getFileIcon(item.name,item.isFolder)}</span>
            <div class="file-info"><span class="file-name">${item.name}</span>
            <span class="file-meta">${item.isFolder ? 'Folder' : (item.obj.size ? (formatBytes(item.obj.size)) : '')}</span></div>`;
        if(item.isFolder) {div.onclick = (e) => {if(e.target.tagName.toLowerCase()!=='input') {path.push(item.name); renderFiles();}};}
        else {div.querySelector('.file-info').onclick = ()=>{ previewFile(item.name); };
            div.querySelector('.file-icon').onclick = ()=>{ previewFile(item.name); };
            div.onkeydown = (e) => {if(e.key==='Enter') previewFile(item.name);};}
        div.querySelector('.file-info').ondblclick = ()=>{ showDetails(item.name, item.isFolder); };
        fileArea.appendChild(div);
    });
    document.getElementById('fileArea').style.gridTemplateColumns=isGrid?'repeat(auto-fill,minmax(65px,1fr))':'repeat(auto-fill,minmax(110px,1fr))';
    document.getElementById('viewIcon').innerText=isGrid?'grid_view':'view_list';
}
function getFileIcon(name,isFolder){
    if(isFolder) return '<span class="material-symbols-outlined" aria-label="Folder">folder</span>';
    let ext=name.split('.').pop().toLowerCase();
    if(['jpg','jpeg','png','gif','webp','svg','bmp'].includes(ext)) return '<span class="material-symbols-outlined" aria-label="Image">image</span>';
    if(['pdf','doc','docx','txt','xlsx','xls','pptx','csv','md'].includes(ext)) return '<span class="material-symbols-outlined" aria-label="Document">description</span>';
    if(['mp4','mov','avi','webm','mkv'].includes(ext)) return '<span class="material-symbols-outlined" aria-label="Video">movie</span>';
    return '<span class="material-symbols-outlined" aria-label="File">insert_drive_file</span>';
}
function formatBytes(bytes){
    if(bytes<1024) return bytes+' B';
    else if(bytes<1024*1024) return (bytes/1024).toFixed(1)+' KB';
    else return (bytes/(1024*1024)).toFixed(2)+' MB';
}
function searchFiles(q){ searchQuery=q; renderFiles(); }
function toggleView(){ isGrid=!isGrid; renderFiles(); }
function sortFiles(){ sortOrder=sortOrder==='name'?'size':'name'; renderFiles(); showToast('Sorted by '+(sortOrder==='name'?'Name':'Size')); }
function fabAction(){
    if(selectedItems.length>0){document.getElementById('fileOperations').style.display='flex';document.getElementById('fabMenu').style.display='none';}
    else{document.getElementById('fabMenu').style.display=document.getElementById('fabMenu').style.display==='flex'?'none':'flex';document.getElementById('fileOperations').style.display='none';}
}
function updateFabIcon(){
    document.getElementById('fabBtn').innerHTML = selectedItems.length>0 ? '<span class="material-symbols-outlined">edit</span>' : '<span class="material-symbols-outlined">add</span>';
}
function toggleSelect(cb,name,isFolder){
    if(cb.checked) selectedItems.push({name,isFolder});
    else selectedItems=selectedItems.filter(i=>i.name!==name||i.isFolder!==isFolder);
    updateFabIcon(); toggleFileOperations(false);
}
function toggleFileOperations(show){ document.getElementById('fileOperations').style.display=show?'flex':'none'; }
function cancelSelection(){ selectedItems=[]; document.querySelectorAll('#fileArea input[type=checkbox]').forEach(cb=>cb.checked=false); updateFabIcon(); toggleFileOperations(false); }
function createFolder(){
    const name=prompt('Folder Name:');
    if(!name||name.includes('/')) return showToast('Invalid folder name');
    const f=getCurrentFolder();
    if(f[name]) return showToast('Already exists');
    f[name]={};localStorage.setItem('files',JSON.stringify(files));renderFiles();showToast('Folder created');
}
function uploadFile(){
    document.getElementById('fileInput').click();document.getElementById('fabMenu').style.display='none';
}
function handleFileUpload(e){
    const f=getCurrentFolder();
    for(const file of e.target.files){
        const reader=new FileReader();
        reader.onload=function(ev){
            f[file.name]={content:ev.target.result,size:file.size,type:file.type,lastModified:file.lastModified};
            localStorage.setItem('files',JSON.stringify(files));
            renderFiles();showToast('File uploaded: '+file.name);
        };
        reader.readAsDataURL(file);}
    e.target.value = '';
}
function confirmDeleteSelected() {
    if(selectedItems.length===0) return showToast('No items selected');
    if(confirm('Are you sure you want to delete selected items?')) {deleteSelected();}
}
function deleteSelected(){
    const f=getCurrentFolder();
    selectedItems.forEach(i=>delete f[i.name]);
    selectedItems=[];localStorage.setItem('files',JSON.stringify(files));renderFiles();showToast('Deleted');
}
function renameSelected(){
    if(selectedItems.length!==1) return showToast('Select only one item');
    const oldName=selectedItems[0].name;
    const newName=prompt('New name:',oldName);
    if(!newName||newName.includes('/')) return showToast('Invalid name');
    const f=getCurrentFolder();
    if(f[newName]) return showToast('Name already exists');
    f[newName]=f[oldName];delete f[oldName];localStorage.setItem('files',JSON.stringify(files));renderFiles();showToast('Renamed');
}
function downloadSelected(){
    selectedItems.forEach(i=>{
        const f=getCurrentFolder()[i.name];
        if(!i.isFolder){
            const a=document.createElement('a');
            a.href=f.content;
            a.download=i.name;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }
    });
    cancelSelection();showToast('Downloaded');
}
function previewSelected(){
    if(selectedItems.length!==1) return showToast('Select only one item');
    previewFile(selectedItems[0].name);selectedItems=[]; updateFabIcon(); toggleFileOperations(false);
}
function previewFile(name){
    const f=getCurrentFolder()[name];
    if(!f) return showToast('File not found!');
    let ext = name.split('.').pop().toLowerCase();
    let isTextFile = ['txt','md','js','json','css','html','csv'].includes(ext);
    let isImage = ['jpg','jpeg','png','gif','webp','svg','bmp'].includes(ext);
    if(isImage) {window.open(f.content, '_blank');}
    else if(['pdf'].includes(ext)) {window.open(f.content, '_blank');}
    else if(isTextFile) {
        let reader = new FileReader();
        reader.onload = function(ev) {alert(ev.target.result);}
        reader.readAsText(dataURLtoBlob(f.content));
    } else {showToast('Preview not available for this file type.');}
}
function showDetailsSelected() {
    if(selectedItems.length!==1) return showToast('Select only one item');
    showDetails(selectedItems[0].name, selectedItems[0].isFolder);
}
function showDetails(name, isFolder) {
    const f=getCurrentFolder()[name];
    if(!f) return showToast('File not found!');
    let details = `Type: ${isFolder?'Folder':(f.type||'Unknown')}\nSize: ${isFolder?'N/A':formatBytes(f.size||0)}\nLast Modified: ${isFolder?'N/A':(f.lastModified?new Date(f.lastModified).toLocaleString():'N/A')}\nPath: ${path.join('/')}/${name}`;
    alert(details);
}
function dataURLtoBlob(dataurl) {
    var arr = dataurl.split(','), mime = arr[0].match(/:(.*?);/)[1],
        bstr = atob(arr[1]), n = bstr.length, u8arr = new Uint8Array(n);
    while(n--){ u8arr[n] = bstr.charCodeAt(n); }
    return new Blob([u8arr], {type:mime});
}
document.addEventListener('dragover',function(e){e.preventDefault();},false);
document.addEventListener('drop',function(e){
    if(document.getElementById('fileArea')) {
        e.preventDefault();
        if(e.dataTransfer.files && e.dataTransfer.files.length){
            document.getElementById('fileInput').files = e.dataTransfer.files;
            handleFileUpload({target:{files:e.dataTransfer.files}});
        }
    }
},false);
function showToast(msg){
    const t=document.getElementById('toast');
    t.innerText=msg;
    t.style.display='block';
    setTimeout(()=>{t.style.display='none';},1200);
}
renderFiles();
</script>
</body>
</html>
